 
Scripts generating Fig. 4, Fig. 4-figSup1, Fig. 4-figSup2
*********************************************************

To run and analyze entrainment simulations using L and D functions
******************************************
1. Open runPhOsc_Boot_LinNLin.m and enter appropriate parameters to 
drive the phase oscillator for specific day lengths, number of 
light-dark cycles, and driving periods (default=24 hrs).
2. In the INDIR and INFILE fields, enter the file name and directory of the 
file containing step-response functions you want to use in simulations. These
are typically previously generated by globalFit_steps_NonParamBoot.m and saved into a 
.mat file. An example file with 4 combinations of L, D, Llin, Dlin, Tlight and Tdark derived from the polarization datasets (Fig. 3C-D) is provided in saved_data/2017-06-05_11.53.10_NonLin_FAST_4.mat file.
3. Hit run. Once complete, the program will generate a time-stamped file
TIMESTAMP_Lin.mat and TIMESTAMP_NonLin.mat files
that will contain your simulation results. The program will also save a timestamped version of the simulation script (e.g., 2017-06-05_11.53.11_runPhOsc_Boot_LinNLin_inKaiCPhaseUnits).
 
To plot simulation results in Fig. 4-figSup2(C). 
**************************
1. Open analyzePhOsc_Sims_Boot_LinNLin.m and enter the file names of the simulation datasets you want to process (generated by runPhOsc_BootLinNlin.m above). Examples of such datasets using both non-linear and linearized L and D are provided in saved_data/2017-04-01_16.55.00_NonLin_FAST_4.mat and saved_data/2017-06-05_11.53.11_Lin_FAST_4.mat.
2. Hit run -- this will generate the figure depicting entrained phases as a function of day length.

To study entrainment from different starting phases (Fig. 4B, Fig. 4-figSup1(A)
***************************************************
1. Open analyzeSingleSimulation_Entrainment.m and input the file name containing the step functions whose properties you'd like to analyze. The set of 4 step-function combinations derived from data in Fig. 3C-D is provided in ../helper functions and shared files/2017-06-05_widefit_mergedStepFuns_11.30.54.mat. Select which L and D combination you want to study by changing the value of boot variable.
2. Select starting phases from which you'd like to run simulations, day lengths, driving periods and numbers of light-dark cycles you want to study. 
2. Hit run. This will generate figures of entrainment dynamics as in Fig. 4B and Fig. 4-figSup1(A).

To study which portions of L and D are used in entrainment (Fig. 4-figSup1(B), Fig. 4-figSup2(B)
**********************************************************
1. Open analyzeSingleSimulation_LinNLin_Two.m and input the file name containing the step functions you want to study. An example file is provided in 2017-06-05_widefit_mergedStepFuns_11.30.54.mat, as described above. Select which of the 4 step function combinations you want to study by setting the value of boot variable (1-4).
2. Also enter the file names of the simulation datasets you want to analyze. Examples are provided in saved_data/2017-04-01_16.55.00_NonLin_FAST_4.mat and saved_data/2017-06-05_11.53.11_Lin_FAST_4.mat. It's not recommended to run simulations for more than about a dozen different day lengths or the colored circles on step-up and step-down functions marking entrained responses become overlapping and cluttered.
3. Select whether you'd like to study the full L and D functions or their linearized versions by setting TOPLOT_LIN_NONLIN = 0 or 1, respectively. 

To make an illustration of phase oscillator entrainment Fig. 4A
*******************************************************
1. Open drivePhaseOscilStepFn_WithBoot_Illustration.m.
2. Set TOTEST=1, TOMAKELDCYCLES_FIG = 1. 
3. Input simulation parameters and hit run. This will generate the figure.